<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>post-files</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
<trans-log-table><connection/>
<schema/>
<table/>
<size_limit_lines/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STATUS</id><enabled>Y</enabled><name>STATUS</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name><subject/></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name><subject/></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name><subject/></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name><subject/></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name><subject/></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name><subject/></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>STARTDATE</id><enabled>Y</enabled><name>STARTDATE</name></field><field><id>ENDDATE</id><enabled>Y</enabled><name>ENDDATE</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>DEPDATE</id><enabled>Y</enabled><name>DEPDATE</name></field><field><id>REPLAYDATE</id><enabled>Y</enabled><name>REPLAYDATE</name></field><field><id>LOG_FIELD</id><enabled>Y</enabled><name>LOG_FIELD</name></field></trans-log-table>
<perf-log-table><connection/>
<schema/>
<table/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>SEQ_NR</id><enabled>Y</enabled><name>SEQ_NR</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>INPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>INPUT_BUFFER_ROWS</name></field><field><id>OUTPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>OUTPUT_BUFFER_ROWS</name></field></perf-log-table>
<channel-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>LOGGING_OBJECT_TYPE</id><enabled>Y</enabled><name>LOGGING_OBJECT_TYPE</name></field><field><id>OBJECT_NAME</id><enabled>Y</enabled><name>OBJECT_NAME</name></field><field><id>OBJECT_COPY</id><enabled>Y</enabled><name>OBJECT_COPY</name></field><field><id>REPOSITORY_DIRECTORY</id><enabled>Y</enabled><name>REPOSITORY_DIRECTORY</name></field><field><id>FILENAME</id><enabled>Y</enabled><name>FILENAME</name></field><field><id>OBJECT_ID</id><enabled>Y</enabled><name>OBJECT_ID</name></field><field><id>OBJECT_REVISION</id><enabled>Y</enabled><name>OBJECT_REVISION</name></field><field><id>PARENT_CHANNEL_ID</id><enabled>Y</enabled><name>PARENT_CHANNEL_ID</name></field><field><id>ROOT_CHANNEL_ID</id><enabled>Y</enabled><name>ROOT_CHANNEL_ID</name></field></channel-log-table>
<step-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field></step-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <created_user>-</created_user>
  <created_date>2015&#47;12&#47;02 14:20:00.105</created_date>
  <modified_user>-</modified_user>
  <modified_date>2015&#47;12&#47;02 14:20:00.105</modified_date>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>siacdb</name>
    <server>${siacdb.host}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${siacdb.name}</database>
    <port>${siacdb.port}</port>
    <username>${siacdb.username}</username>
    <password>${siacdb.password}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${siacdb.port}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>siacdb_coll</name>
    <server>coll-db1.bilancio.csi.it</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>TSTBIL1</database>
    <port>5432</port>
    <username>siac</username>
    <password>Encrypted 2be98afc86aa7f2e4cb79a369ce93bcc9</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>5432</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
  <hop> <from>Prepare request</from><to>HTTP Post</to><enabled>Y</enabled> </hop>  <hop> <from>read_account_id</from><to>join</to><enabled>Y</enabled> </hop>  <hop> <from>join</from><to>Prepare request</to><enabled>Y</enabled> </hop>  <hop> <from>load file content</from><to>join</to><enabled>Y</enabled> </hop>  <hop> <from>Parse SOAP Response</from><to>Err</to><enabled>Y</enabled> </hop>  <hop> <from>read file_tipo_id</from><to>join</to><enabled>Y</enabled> </hop>  <hop> <from>Get rows from result</from><to>L1</to><enabled>Y</enabled> </hop>  <hop> <from>L1</from><to>load file content</to><enabled>Y</enabled> </hop>  <hop> <from>HTTP Post</from><to>L2</to><enabled>Y</enabled> </hop>  <hop> <from>L2</from><to>Parse SOAP Response</to><enabled>Y</enabled> </hop>  <hop> <from>Err</from><to>Abort</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>Abort</name>
    <type>Abort</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <row_threshold>0</row_threshold>
      <message/>
      <always_log_rows>Y</always_log_rows>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>897</xloc>
      <yloc>441</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Err</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_basic</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage/>
    <fields>
      <field>
        <name>account_id</name>
        </field>
      <field>
        <name>filename</name>
        </field>
      <field>
        <name>responseXml</name>
        </field>
      <field>
        <name>httpStatus</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>898</xloc>
      <yloc>336</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Get rows from result</name>
    <type>RowsFromResult</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>type</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>filename</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>path</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>parentorigin</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>origin</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>comment</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>timestamp</name>
        <type>-</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>213</xloc>
      <yloc>18</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>HTTP Post</name>
    <type>HTTPPOST</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <postafile>N</postafile>
    <encoding/>
    <url>${oil.ws.fileservice.endpoint}</url>
    <urlInField>N</urlInField>
    <urlField/>
    <requestEntity>soap_request</requestEntity>
    <httpLogin/>
    <httpPassword/>
    <proxyHost/>
    <proxyPort/>
    <lookup>
      </lookup>
    <result>
      <name>responseXml</name>
      <code>httpStatus</code>
      <response_time/>
      </result>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>625</xloc>
      <yloc>312</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>L1</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_basic</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage>Preparazione all&apos;upload del file</logmessage>
    <fields>
      <field>
        <name>type</name>
        </field>
      <field>
        <name>filename</name>
        </field>
      <field>
        <name>path</name>
        </field>
      <field>
        <name>parentorigin</name>
        </field>
      <field>
        <name>origin</name>
        </field>
      <field>
        <name>comment</name>
        </field>
      <field>
        <name>timestamp</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>435</xloc>
      <yloc>18</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>L2</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_detailed</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage/>
    <fields>
      <field>
        <name>responseXml</name>
        </field>
      <field>
        <name>httpStatus</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>763</xloc>
      <yloc>230</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Parse SOAP Response</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>VerifyEmail</jsScript_name>
        <jsScript_script>&#47;*
	sample response
	--------------------------------------

&lt;soap:Envelope xmlns:soap=&quot;http:&#47;&#47;www.w3.org&#47;2003&#47;05&#47;soap-envelope&quot;&gt;
   &lt;soap:Body&gt;
      &lt;ns2:uploadFileResponse xmlns:ns2=&quot;http:&#47;&#47;siac.csi.it&#47;cor&#47;svc&#47;1.0&quot;&gt;
         &lt;cardinalitaComplessiva&gt;1&lt;&#47;cardinalitaComplessiva&gt;
         &lt;esito&gt;SUCCESSO&lt;&#47;esito&gt;
         &lt;file&gt;
            &lt;dataCreazione&gt;2016-01-22T11:54:39.250+01:00&lt;&#47;dataCreazione&gt;
            &lt;dataInizioValidita&gt;2016-01-22T11:54:39.250+01:00&lt;&#47;dataInizioValidita&gt;
            &lt;dataModifica&gt;2016-01-22T11:54:39.250+01:00&lt;&#47;dataModifica&gt;
            &lt;loginOperazione&gt;SIAC-COTO&lt;&#47;loginOperazione&gt;
            &lt;stato&gt;VALIDO&lt;&#47;stato&gt;
            &lt;uid&gt;656&lt;&#47;uid&gt;
            &lt;codice&gt;CODICE ELABORAZIONE&lt;&#47;codice&gt;
            &lt;contenuto&gt;contenutofin&lt;&#47;contenuto&gt;
            &lt;mimeType&gt;text&#47;xml&lt;&#47;mimeType&gt;
            &lt;nome&gt;nomefile_di_prova&lt;&#47;nome&gt;
            &lt;note&gt;ELABORAZIONE ORDINATIVI prova&lt;&#47;note&gt;
            &lt;statoFile&gt;
               &lt;dataCreazione&gt;2016-01-22T11:54:39.250+01:00&lt;&#47;dataCreazione&gt;
               &lt;dataInizioValidita&gt;2016-01-22T11:54:39.250+01:00&lt;&#47;dataInizioValidita&gt;
               &lt;dataModifica&gt;2016-01-22T11:54:39.250+01:00&lt;&#47;dataModifica&gt;
               &lt;stato&gt;VALIDO&lt;&#47;stato&gt;
               &lt;uid&gt;8&lt;&#47;uid&gt;
               &lt;codice&gt;ELABORATO&lt;&#47;codice&gt;
            &lt;&#47;statoFile&gt;
            &lt;tipo&gt;
               &lt;stato&gt;VALIDO&lt;&#47;stato&gt;
               &lt;uid&gt;369&lt;&#47;uid&gt;
            &lt;&#47;tipo&gt;
         &lt;&#47;file&gt;
      &lt;&#47;ns2:uploadFileResponse&gt;
   &lt;&#47;soap:Body&gt;
&lt;&#47;soap:Envelope&gt;
*&#47;

&#47;&#47; E4X needs to get rid of the &lt;xml&gt; header for security reasons...
&#47;&#47; See also: bug 336551, https:&#47;&#47;bugzilla.mozilla.org&#47;show_bug.cgi?id=336551
&#47;&#47; 

responseXml = responseXml.replace(&#47;^&lt;\?xml\s+version\s*=\s*([&quot;&apos;])[^\1]+\1[^?]*\?&gt;&#47;, &quot;&quot;);
&#47;&#47;Alert(responseXml);

var soapResponse = new XML(responseXml);

&#47;&#47; Inizializza i namespace principali
var soap = soapResponse.namespace();
var ns = new Namespace(&quot;http:&#47;&#47;siac.csi.it&#47;cor&#47;svc&#47;1.0&quot;);


&#47;&#47; Grab the body inside the SOAP response:
var fault = soapResponse.soap::Body.soap::Fault;
var response = soapResponse.soap::Body.ns::uploadFileResponse;

if ( fault.length() &gt; 0 ) {
&#47;&#47;	Alert(&quot;Unable to call soap fault&quot;);
	trans_Status = SKIP_TRANSFORMATION;
	var code = fault.soap::Code.soap::Value;
	_step_.putError(getInputRowMeta(), row, 1, &quot;soap_fault&quot;, &quot;code&quot;, code);
} else if ( response.esito != &quot;SUCCESSO&quot; )  {
	trans_Status = SKIP_TRANSFORMATION;
	_step_.putError(getInputRowMeta(), row, 1, &quot;app_response&quot;, &quot;esito&quot;, response.esito);
}
</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>soapResponse</name>
        <rename>soapResponse</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>esito</name>
        <rename>esito</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>idOperazione</name>
        <rename>idOperazione</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>filename</name>
        <rename>filename</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>soapResponse</name>
        <rename>soapResponse</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>soap</name>
        <rename>soap</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>ns</name>
        <rename>ns</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>response</name>
        <rename>response</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>fault</name>
        <rename>fault</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>outfolder</name>
        <rename>outfolder</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>processed_file</name>
        <rename>processed_file</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>esito</name>
        <rename>esito</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>idOperazione</name>
        <rename>idOperazione</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>899</xloc>
      <yloc>230</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Prepare request</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>_now_ = new java.util.Date();
note_suffix = getVariable(&quot;TIPO_FLUSSO&quot;,&quot;???&quot;);
ente_proprietario_id = getVariable(&quot;ente_proprietario_id&quot;,&quot;???&quot;);

var contenuto = new Packages.java.lang.String( Packages.org.apache.commons.codec.binary.Base64.encodeBase64(file_content.getBytes() ) );

&#47;*
var template = &quot;&lt;soap:Envelope xmlns:soap=&apos;http:&#47;&#47;www.w3.org&#47;2003&#47;05&#47;soap-envelope&apos; xmlns:ns=&apos;http:&#47;&#47;siac.csi.it&#47;cor&#47;svc&#47;1.0&apos;&gt;&quot;
 + &quot;&lt;soap:Header&#47;&gt;&quot;
 + &quot;&lt;soap:Body&gt;&quot;
 + &quot;&lt;ns:uploadFile&gt;&quot;
 + &quot;&lt;richiedente&gt;&quot;
 + &quot;&lt;account&gt;&quot;
 + &quot;&lt;uid&gt;&quot; + account_id + &quot;&lt;&#47;uid&gt;&quot;
 + &quot;&lt;&#47;account&gt;&quot;
 + &quot;&lt;operatore&gt;&quot;
 + &quot;&lt;codiceFiscale&gt;&quot; + &quot;SIAC-&quot; + getVariable(&quot;codice_ente&quot;,&quot;???&quot;) + &quot;&lt;&#47;codiceFiscale&gt;&quot;
 + &quot;&lt;&#47;operatore&gt;&quot;
 + &quot;&lt;&#47;richiedente&gt;&quot;
 + &quot;&lt;ente&gt;&quot;
 + &quot;&lt;uid&gt;&quot;+ ente_proprietario_id +&quot;&lt;&#47;uid&gt;&quot;
 + &quot;&lt;&#47;ente&gt;&quot;
 + &quot;&lt;file&gt;&quot;
 + &quot;&lt;codice&gt;CODICE ELABORAZIONE&lt;&#47;codice&gt;&quot;
 + &quot;&lt;contenuto&gt;&quot; + contenuto + &quot;&lt;&#47;contenuto&gt;&quot;
 + &quot;&lt;mimeType&gt;text&#47;xml&lt;&#47;mimeType&gt;&quot;
 + &quot;&lt;nome&gt;&quot; + filename + &quot;&lt;&#47;nome&gt;&quot;
 + &quot;&lt;note&gt; ELABORAZIONE ORDINATIVI &quot; + note_suffix + &quot;&lt;&#47;note&gt;&quot;
 + &quot;&lt;statoFile&gt;&quot;
 + &quot;&lt;codice&gt;ELABORATO&lt;&#47;codice&gt;&quot;
 + &quot;&lt;&#47;statoFile&gt;&quot;
 + &quot;&lt;tipo&gt;&quot;
 + &quot;&lt;uid&gt;&quot; + file_tipo_id + &quot;&lt;&#47;uid&gt;&quot;
 + &quot;&lt;&#47;tipo&gt;&quot;
 + &quot;&lt;&#47;file&gt;&quot;
 + &quot;&lt;&#47;ns:uploadFile&gt;&quot;
 + &quot;&lt;&#47;soap:Body&gt;&quot;
 + &quot;&lt;&#47;soap:Envelope&gt;&quot;;

var soap_request = template;
*&#47;

var cod_fiscale = &quot;SIAC-&quot; + getVariable(&quot;codice_ente&quot;,&quot;???&quot;);
var flussomif_dist_oilid = &quot;&quot; + getVariable(&quot;FLUSSOMIF_DIST_OILID&quot;,&quot;???&quot;);
var note = &quot;ELABORAZIONE ORDINATIVI &quot; + note_suffix;

var template = &lt;soap:Envelope xmlns:soap=&apos;http:&#47;&#47;www.w3.org&#47;2003&#47;05&#47;soap-envelope&apos; xmlns:ns=&apos;http:&#47;&#47;siac.csi.it&#47;cor&#47;svc&#47;1.0&apos;&gt;
&lt;soap:Header&#47;&gt;
	&lt;soap:Body&gt;
		&lt;ns:uploadFile&gt;
			&lt;richiedente&gt;
				&lt;account&gt;
					&lt;uid&gt;{account_id}&lt;&#47;uid&gt;
				&lt;&#47;account&gt;
				&lt;operatore&gt;
					&lt;codiceFiscale&gt;{cod_fiscale}&lt;&#47;codiceFiscale&gt;
				&lt;&#47;operatore&gt;
			&lt;&#47;richiedente&gt;
			&lt;ente&gt;
				&lt;uid&gt;{ente_proprietario_id}&lt;&#47;uid&gt;
			&lt;&#47;ente&gt;
			&lt;file&gt;
				&lt;codice&gt;{flussomif_dist_oilid}&lt;&#47;codice&gt;
				&lt;contenuto&gt;{contenuto}&lt;&#47;contenuto&gt;
				&lt;mimeType&gt;text&#47;xml&lt;&#47;mimeType&gt;
				&lt;nome&gt;{filename}&lt;&#47;nome&gt;
				&lt;note&gt;{note}&lt;&#47;note&gt;
				&lt;statoFile&gt;
					&lt;codice&gt;ELABORATO&lt;&#47;codice&gt;
				&lt;&#47;statoFile&gt;
				&lt;tipo&gt;
					&lt;uid&gt;{file_tipo_id}&lt;&#47;uid&gt;
				&lt;&#47;tipo&gt;
			&lt;&#47;file&gt;
		&lt;&#47;ns:uploadFile&gt;
	&lt;&#47;soap:Body&gt;
&lt;&#47;soap:Envelope&gt;;

var soap_request = template.toString();

</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>soap_request</name>
        <rename>soap_request</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>624</xloc>
      <yloc>175</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>join</name>
    <type>JoinRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>out</prefix>
      <cache_size>500</cache_size>
      <main>load file content</main>
    <compare>
<condition>
 <negated>N</negated>
 <leftvalue/>
 <function>=</function>
 <rightvalue/>
 </condition>
    </compare>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>467</xloc>
      <yloc>175</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>load file content</name>
    <type>LoadFileInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>Y</addresultfile>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <rownum_field/>
    <encoding/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
      </file>
    <fields>
      <field>
        <name>file_content</name>
        <element_type>content</element_type>
        <type>Binary</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
        </field>
      <field>
        <name>file_size</name>
        <element_type>size</element_type>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
        </field>
      </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <DynamicFilenameField>path</DynamicFilenameField>
    <shortFileFieldName/>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>602</xloc>
      <yloc>18</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>read file_tipo_id</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>siacdb</connection>
    <sql>select 
	file_tipo_id, 
	file_tipo_code 
from 
	siac_d_file_tipo 
where 0=0
	and file_tipo_code = &apos;${TIPO_FLUSSO}&apos; 
	and ente_proprietario_id = ${ente_proprietario_id}</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>349</xloc>
      <yloc>251</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>read_account_id</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>siacdb</connection>
    <sql>select account_id::integer from siac_t_account where account_code = &apos;SIAC-&apos; || &apos;${codice_ente}&apos;</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>353</xloc>
      <yloc>110</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
      <error>
        <source_step>Parse SOAP Response</source_step>
        <target_step>Err</target_step>
        <is_enabled>Y</is_enabled>
        <nr_valuename/>
        <descriptions_valuename>err_descr</descriptions_valuename>
        <fields_valuename>err_field</fields_valuename>
        <codes_valuename>err_code</codes_valuename>
        <max_errors/>
        <max_pct_errors/>
        <min_pct_rows/>
      </error>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
