<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>post-atti_amministrativi</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
<trans-log-table><connection/>
<schema/>
<table/>
<size_limit_lines/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STATUS</id><enabled>Y</enabled><name>STATUS</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name><subject/></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name><subject/></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name><subject/></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name><subject/></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name><subject/></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name><subject/></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>STARTDATE</id><enabled>Y</enabled><name>STARTDATE</name></field><field><id>ENDDATE</id><enabled>Y</enabled><name>ENDDATE</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>DEPDATE</id><enabled>Y</enabled><name>DEPDATE</name></field><field><id>REPLAYDATE</id><enabled>Y</enabled><name>REPLAYDATE</name></field><field><id>LOG_FIELD</id><enabled>Y</enabled><name>LOG_FIELD</name></field></trans-log-table>
<perf-log-table><connection/>
<schema/>
<table/>
<interval/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>SEQ_NR</id><enabled>Y</enabled><name>SEQ_NR</name></field><field><id>LOGDATE</id><enabled>Y</enabled><name>LOGDATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>INPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>INPUT_BUFFER_ROWS</name></field><field><id>OUTPUT_BUFFER_ROWS</id><enabled>Y</enabled><name>OUTPUT_BUFFER_ROWS</name></field></perf-log-table>
<channel-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>LOGGING_OBJECT_TYPE</id><enabled>Y</enabled><name>LOGGING_OBJECT_TYPE</name></field><field><id>OBJECT_NAME</id><enabled>Y</enabled><name>OBJECT_NAME</name></field><field><id>OBJECT_COPY</id><enabled>Y</enabled><name>OBJECT_COPY</name></field><field><id>REPOSITORY_DIRECTORY</id><enabled>Y</enabled><name>REPOSITORY_DIRECTORY</name></field><field><id>FILENAME</id><enabled>Y</enabled><name>FILENAME</name></field><field><id>OBJECT_ID</id><enabled>Y</enabled><name>OBJECT_ID</name></field><field><id>OBJECT_REVISION</id><enabled>Y</enabled><name>OBJECT_REVISION</name></field><field><id>PARENT_CHANNEL_ID</id><enabled>Y</enabled><name>PARENT_CHANNEL_ID</name></field><field><id>ROOT_CHANNEL_ID</id><enabled>Y</enabled><name>ROOT_CHANNEL_ID</name></field></channel-log-table>
<step-log-table><connection/>
<schema/>
<table/>
<timeout_days/>
<field><id>ID_BATCH</id><enabled>Y</enabled><name>ID_BATCH</name></field><field><id>CHANNEL_ID</id><enabled>Y</enabled><name>CHANNEL_ID</name></field><field><id>LOG_DATE</id><enabled>Y</enabled><name>LOG_DATE</name></field><field><id>TRANSNAME</id><enabled>Y</enabled><name>TRANSNAME</name></field><field><id>STEPNAME</id><enabled>Y</enabled><name>STEPNAME</name></field><field><id>STEP_COPY</id><enabled>Y</enabled><name>STEP_COPY</name></field><field><id>LINES_READ</id><enabled>Y</enabled><name>LINES_READ</name></field><field><id>LINES_WRITTEN</id><enabled>Y</enabled><name>LINES_WRITTEN</name></field><field><id>LINES_UPDATED</id><enabled>Y</enabled><name>LINES_UPDATED</name></field><field><id>LINES_INPUT</id><enabled>Y</enabled><name>LINES_INPUT</name></field><field><id>LINES_OUTPUT</id><enabled>Y</enabled><name>LINES_OUTPUT</name></field><field><id>LINES_REJECTED</id><enabled>Y</enabled><name>LINES_REJECTED</name></field><field><id>ERRORS</id><enabled>Y</enabled><name>ERRORS</name></field><field><id>LOG_FIELD</id><enabled>N</enabled><name>LOG_FIELD</name></field></step-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <created_user>-</created_user>
  <created_date>2015&#47;09&#47;09 14:04:07.594</created_date>
  <modified_user>-</modified_user>
  <modified_date>2015&#47;09&#47;09 14:04:07.594</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
  <hop> <from>Parse SOAP Response</from><to>FAILED_REQUEST</to><enabled>Y</enabled> </hop>  <hop> <from>Select values</from><to>get-workdir</to><enabled>Y</enabled> </hop>  <hop> <from>get-workdir</from><to>cp file</to><enabled>Y</enabled> </hop>  <hop> <from>Parse SOAP Response</from><to>L3S</to><enabled>Y</enabled> </hop>  <hop> <from>FAILED_REQUEST</from><to>Abort</to><enabled>Y</enabled> </hop>  <hop> <from>get-rows</from><to>file_selezionato</to><enabled>Y</enabled> </hop>  <hop> <from>file_selezionato</from><to>Select values</to><enabled>Y</enabled> </hop>  <hop> <from>cp file</from><to>load file content</to><enabled>Y</enabled> </hop>  <hop> <from>HTTP Post</from><to>L2</to><enabled>Y</enabled> </hop>  <hop> <from>L2</from><to>Parse SOAP Response</to><enabled>Y</enabled> </hop>  <hop> <from>delete origin file</from><to>setup archive folder</to><enabled>Y</enabled> </hop>  <hop> <from>setup archive folder</from><to>archive stage&#47;work file</to><enabled>Y</enabled> </hop>  <hop> <from>test filesize</from><to>PrepareXmlRequest</to><enabled>Y</enabled> </hop>  <hop> <from>load file content</from><to>test filesize</to><enabled>Y</enabled> </hop>  <hop> <from>L3S</from><to>filterout</to><enabled>Y</enabled> </hop>  <hop> <from>filterout</from><to>delete origin file</to><enabled>Y</enabled> </hop>  <hop> <from>test filesize</from><to>delete origin file</to><enabled>Y</enabled> </hop>  <hop> <from>archive stage&#47;work file</from><to>L4</to><enabled>Y</enabled> </hop>  <hop> <from>PrepareXmlRequest</from><to>Delay row</to><enabled>Y</enabled> </hop>  <hop> <from>Delay row</from><to>HTTP Post</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>Abort</name>
    <type>Abort</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <row_threshold>0</row_threshold>
      <message>Failed to post</message>
      <always_log_rows>N</always_log_rows>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>648</xloc>
      <yloc>769</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Delay row</name>
    <type>Delay</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <timeout>12</timeout>
    <scaletime>seconds</scaletime>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>540</xloc>
      <yloc>316</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>FAILED_REQUEST</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_basic</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage>Richiesta Elaborazione Fallita</logmessage>
    <fields>
      <field>
        <name>int_type</name>
        </field>
      <field>
        <name>int_filename</name>
        </field>
      <field>
        <name>int_path</name>
        </field>
      <field>
        <name>path</name>
        </field>
      <field>
        <name>file_content</name>
        </field>
      <field>
        <name>file_size</name>
        </field>
      <field>
        <name>short_filename</name>
        </field>
      <field>
        <name>requestXml</name>
        </field>
      <field>
        <name>responseXml</name>
        </field>
      <field>
        <name>httpStatus</name>
        </field>
      <field>
        <name>e_count</name>
        </field>
      <field>
        <name>e_descr</name>
        </field>
      <field>
        <name>e_field</name>
        </field>
      <field>
        <name>e_code</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>647</xloc>
      <yloc>673</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>HTTP Post</name>
    <type>HTTPPOST</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <postafile>N</postafile>
    <encoding/>
    <url>${wsElaboraDocumento.endpoint}</url>
    <urlInField>N</urlInField>
    <urlField/>
    <requestEntity>requestXml</requestEntity>
    <httpLogin/>
    <httpPassword/>
    <proxyHost/>
    <proxyPort/>
    <lookup>
      </lookup>
    <result>
      <name>responseXml</name>
      <code>httpStatus</code>
      <response_time/>
      </result>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>648</xloc>
      <yloc>387</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>L2</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_detailed</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage/>
    <fields>
      <field>
        <name>int_type</name>
        </field>
      <field>
        <name>int_filename</name>
        </field>
      <field>
        <name>int_path</name>
        </field>
      <field>
        <name>path</name>
        </field>
      <field>
        <name>requestXml</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>648</xloc>
      <yloc>463</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>L3S</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_basic</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage>Richiesta Elaborazione Accettata</logmessage>
    <fields>
      <field>
        <name>idOperazione</name>
        </field>
      <field>
        <name>int_path</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>801</xloc>
      <yloc>540</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>L4</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_basic</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage/>
    <fields>
      <field>
        <name>int_path</name>
        </field>
      <field>
        <name>path</name>
        </field>
      <field>
        <name>archive_filename</name>
        </field>
      <field>
        <name>file_size</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1056</xloc>
      <yloc>860</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Parse SOAP Response</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>VerifyEmail</jsScript_name>
        <jsScript_script>&#47;*

  This is a response that is received:
  ---------------------------------------

&lt;soapenv:Envelope xmlns:soapenv=&quot;http:&#47;&#47;schemas.xmlsoap.org&#47;soap&#47;envelope&#47;&quot; xmlns:ns=&quot;http:&#47;&#47;siac.csi.it&#47;documenti&#47;svc&#47;1.0&quot;&gt;
   &lt;soapenv:Header&#47;&gt;
   &lt;soapenv:Body&gt;
      &lt;ns:elaboraDocumentoAsyncResponse&gt;
         &lt;ente&gt;
            &lt;codice&gt;?&lt;&#47;codice&gt;
            &lt;stato&gt;
               &lt;codice&gt;?&lt;&#47;codice&gt;
               &lt;stato&#47;&gt;
               &lt;descrizione&gt;?&lt;&#47;descrizione&gt;
            &lt;&#47;stato&gt;
            &lt;descrizione&gt;?&lt;&#47;descrizione&gt;
         &lt;&#47;ente&gt;
		 
         &lt;errori&gt;
            &lt;codice&gt;?&lt;&#47;codice&gt;
            &lt;stato&gt;
               &lt;codice&gt;?&lt;&#47;codice&gt;
               &lt;stato&#47;&gt;
               &lt;descrizione&gt;?&lt;&#47;descrizione&gt;
            &lt;&#47;stato&gt;
            &lt;descrizione&gt;?&lt;&#47;descrizione&gt;
         &lt;&#47;errori&gt;
         &lt;esito&gt;?&lt;&#47;esito&gt;
		 
         &lt;messaggi&gt;
            &lt;codice&gt;?&lt;&#47;codice&gt;
            &lt;stato&gt;
               &lt;codice&gt;?&lt;&#47;codice&gt;
               &lt;stato&#47;&gt;
               &lt;descrizione&gt;?&lt;&#47;descrizione&gt;
            &lt;&#47;stato&gt;
            &lt;descrizione&gt;?&lt;&#47;descrizione&gt;
         &lt;&#47;messaggi&gt;
         &lt;idOperazioneAsincrona&gt;?&lt;&#47;idOperazioneAsincrona&gt;
      &lt;&#47;ns:elaboraDocumentoAsyncResponse&gt;
   &lt;&#47;soapenv:Body&gt;
&lt;&#47;soapenv:Envelope&gt;
*&#47;

&#47;&#47; E4X needs to get rid of the &lt;xml&gt; header for security reasons...
&#47;&#47; See also: bug 336551, https:&#47;&#47;bugzilla.mozilla.org&#47;show_bug.cgi?id=336551
&#47;&#47; 
responseXml = responseXml.replace(&#47;^&lt;\?xml\s+version\s*=\s*([&quot;&apos;])[^\1]+\1[^?]*\?&gt;&#47;, &quot;&quot;);
var soapResponse = new XML(responseXml);

&#47;&#47; Inizializza i namespace principali
var soap = soapResponse.namespace();
var ns = new Namespace(&quot;http:&#47;&#47;siac.csi.it&#47;documenti&#47;svc&#47;1.0&quot;);

&#47;&#47; Grab the body inside the SOAP response:
var response = soapResponse.soap::Body.ns::elaboraDocumentoAsyncResponse;
var fault = soapResponse.soap::Body.soap::Fault;

&#47;&#47; Alert(&quot;Got Response = &apos;&quot; + fault + &quot;&apos;&quot;);

&#47;*
	Controlla che non ci sia stato un soap fault
*&#47;

&#47;&#47;var outfolder = getVariable(&quot;work_area.dir&quot;, &quot;&#47;skedul&#47;progetti&#47;siac&#47;dati&#47;inout&quot;);
&#47;&#47;var processed_file;
var esito = response.esito;
var idOperazione = response.idOperazioneAsincrona;

if ( esito != &quot;SUCCESSO&quot; )
{
	trans_Status = SKIP_TRANSFORMATION;
	_step_.putError(getInputRowMeta(), row, 1, &quot;esito:&quot;+esito, &quot;soap_response&quot;, &quot;ERR-&quot; + esito);
}


</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>soapResponse</name>
        <rename>soapResponse</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>esito</name>
        <rename>esito</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>idOperazione</name>
        <rename>idOperazione</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>filename</name>
        <rename>filename</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>soap</name>
        <rename>soap</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>ns</name>
        <rename>ns</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>response</name>
        <rename>response</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>fault</name>
        <rename>fault</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>outfolder</name>
        <rename>outfolder</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>processed_file</name>
        <rename>processed_file</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>647</xloc>
      <yloc>540</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>PrepareXmlRequest</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var codice_ente = getVariable(&quot;codice_ente&quot;,&quot;???&quot;);


var requestXml = &quot;&quot;;

_now_ = new java.util.Date();
if ( &quot;???&quot;.equals(codice_ente) ) {
	trans_Status = SKIP_TRANSFORMATION; &#47;&#47; ERROR_TRANSFORMATION;
} else {

	&#47;&#47; var contenuto = new Packages.java.lang.String( Packages.org.apache.commons.codec.binary.Base64.encodeBase64(file_content.getBytes() ) );
	var contenuto = file_content;

requestXml = 
     &quot;&lt;soapenv:Envelope xmlns:soapenv=\&quot;http:&#47;&#47;schemas.xmlsoap.org&#47;soap&#47;envelope&#47;\&quot; xmlns:ns=\&quot;http:&#47;&#47;siac.csi.it&#47;documenti&#47;svc&#47;1.0\&quot;&gt;&quot;
   + &quot;&lt;soapenv:Header&#47;&gt;&quot;
   + &quot;&lt;soapenv:Body&gt;&quot;
   +    &quot;&lt;ns:elaboraDocumentoAsync&gt;&quot;
   +      &quot;&lt;annoBilancio&gt;&quot; + year(_now_) + &quot;&lt;&#47;annoBilancio&gt;&quot;
   +      &quot;&lt;codiceEnte&gt;&quot; + codice_ente + &quot;&lt;&#47;codiceEnte&gt;&quot;
   +      &quot;&lt;codiceFruitore&gt;SIAC&lt;&#47;codiceFruitore&gt;&quot;
   +      &quot;&lt;codiceTipoDocumento&gt;FLUSSO_ATTI&lt;&#47;codiceTipoDocumento&gt;&quot;
   +      &quot;&lt;contenutoDocumento&gt;&lt;![CDATA[&quot; + contenuto + &quot;]]&gt;&quot; + &quot;&lt;&#47;contenutoDocumento&gt;&quot;
   +    &quot;&lt;&#47;ns:elaboraDocumentoAsync&gt;&quot;
   + &quot;&lt;&#47;soapenv:Body&gt;&quot;
   + &quot;&lt;&#47;soapenv:Envelope&gt;&quot;;
}</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>requestXml</name>
        <rename>requestXml</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>647</xloc>
      <yloc>245</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>type</name>
        <rename>int_type</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>filename</name>
        <rename>int_filename</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>path</name>
        <rename>int_path</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>Y</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>277</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>archive stage&#47;work file</name>
    <type>ProcessFiles</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <sourcefilenamefield>path</sourcefilenamefield>
    <targetfilenamefield>archive_filename</targetfilenamefield>
    <operation_type>move</operation_type>
    <addresultfilenames>N</addresultfilenames>
    <overwritetargetfile>Y</overwritetargetfile>
    <createparentfolder>Y</createparentfolder>
    <simulate>N</simulate>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1056</xloc>
      <yloc>765</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>cp file</name>
    <type>ProcessFiles</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <sourcefilenamefield>int_path</sourcefilenamefield>
    <targetfilenamefield>path</targetfilenamefield>
    <operation_type>copy</operation_type>
    <addresultfilenames>N</addresultfilenames>
    <overwritetargetfile>Y</overwritetargetfile>
    <createparentfolder>Y</createparentfolder>
    <simulate>N</simulate>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>523</xloc>
      <yloc>95</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>delete origin file</name>
    <type>ProcessFiles</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <sourcefilenamefield>int_path</sourcefilenamefield>
    <targetfilenamefield>processed_file</targetfilenamefield>
    <operation_type>delete</operation_type>
    <addresultfilenames>N</addresultfilenames>
    <overwritetargetfile>Y</overwritetargetfile>
    <createparentfolder>Y</createparentfolder>
    <simulate>N</simulate>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1057</xloc>
      <yloc>541</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>file_selezionato</name>
    <type>WriteToLog</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <loglevel>log_level_basic</loglevel>
      <displayHeader>Y</displayHeader>
      <logmessage>Got file</logmessage>
    <fields>
      <field>
        <name>type</name>
        </field>
      <field>
        <name>filename</name>
        </field>
      <field>
        <name>path</name>
        </field>
      </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>81</xloc>
      <yloc>95</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>filterout</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>int_type</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>int_filename</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>int_path</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>path</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>file_content</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>file_size</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>short_filename</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>N</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>868</xloc>
      <yloc>539</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>get-rows</name>
    <type>RowsFromResult</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>type</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>filename</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      <field>        <name>path</name>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        </field>      </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>80</xloc>
      <yloc>5</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>get-workdir</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script qua

var path = getVariable(&quot;work_area.dir&quot;,&quot;&quot;) + &quot;&#47;&quot; + int_filename;</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>path</name>
        <rename>path</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>384</xloc>
      <yloc>95</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>load file content</name>
    <type>LoadFileInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <addresultfile>Y</addresultfile>
    <IsIgnoreEmptyFile>N</IsIgnoreEmptyFile>
    <rownum_field/>
    <encoding/>
    <file>
      <name/>
      <filemask/>
      <exclude_filemask/>
      <file_required>N</file_required>
      <include_subfolders>N</include_subfolders>
      </file>
    <fields>
      <field>
        <name>file_content</name>
        <element_type>content</element_type>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
        </field>
      <field>
        <name>file_size</name>
        <element_type>size</element_type>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
        </field>
      </fields>
    <limit>0</limit>
    <IsInFields>Y</IsInFields>
    <DynamicFilenameField>path</DynamicFilenameField>
    <shortFileFieldName>short_filename</shortFileFieldName>
    <pathFieldName/>
    <hiddenFieldName/>
    <lastModificationTimeFieldName/>
    <uriNameFieldName/>
    <rootUriNameFieldName/>
    <extensionFieldName/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>646</xloc>
      <yloc>94</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>setup archive folder</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var codice_ente = getVariable(&quot;codice_ente&quot;,&quot;EEEE&quot;);
var codice_prod = getVariable(&quot;cod_producer&quot;,&quot;PPPPPP&quot;);

folder = &quot;&#47;skedul&#47;archivio&#47;siac-int-01&#47;atti&#47;&quot; + codice_prod + &quot;&#47;&quot; + codice_ente;

&#47;&#47; short_filename has trailing spaces (due to field definition?)
&#47;&#47; trim to make sure to remove 
var archive_filename = trim(folder + &quot;&#47;&quot; + short_filename)
</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>archive_filename</name>
        <rename>archive_filename</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1056</xloc>
      <yloc>648</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>test filesize</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<fieldname>file_size</fieldname>
<use_contains>N</use_contains>
<case_value_type>Integer</case_value_type>
<case_value_format/>
<case_value_decimal/>
<case_value_group/>
<default_target_step>PrepareXmlRequest</default_target_step>
<cases><case><value>0</value>
<target_step>delete origin file</target_step>
</case></cases>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>790</xloc>
      <yloc>163</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
      <error>
        <source_step>Parse SOAP Response</source_step>
        <target_step>FAILED_REQUEST</target_step>
        <is_enabled>Y</is_enabled>
        <nr_valuename>e_count</nr_valuename>
        <descriptions_valuename>e_descr</descriptions_valuename>
        <fields_valuename>e_field</fields_valuename>
        <codes_valuename>e_code</codes_valuename>
        <max_errors/>
        <max_pct_errors/>
        <min_pct_rows/>
      </error>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
